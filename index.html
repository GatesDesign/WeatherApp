<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeatherCast Pro - Live Weather Forecast</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <style>
        :root {
            /* Light Theme Variables */
            --primary: #4a6fa5;
            --secondary: #166088;
            --accent: #32a1ce;
            --bg-gradient-1: #f5f7fa;
            --bg-gradient-2: #c3cfe2;
            --card-bg: #ffffff;
            --text-primary: #343a40;
            --text-secondary: #666666;
            --text-muted: #888888;
            --element-bg: #f8f9fa;
            --border-color: #e0e0e0;
            --shadow-color: rgba(0, 0, 0, 0.12);
            --hover-shadow: rgba(0, 0, 0, 0.1);
            --error-bg: #ffebee;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --border-radius: 15px;
            --box-shadow: 0 8px 30px var(--shadow-color);
            --transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            /* Dark Theme Variables */
            --primary: #6a8fc5;
            --secondary: #2a80b8;
            --accent: #4ac1ee;
            --bg-gradient-1: #1a1a2e;
            --bg-gradient-2: #16213e;
            --card-bg: #222831;
            --text-primary: #eeeeee;
            --text-secondary: #b0b0b0;
            --text-muted: #888888;
            --element-bg: #2d4059;
            --border-color: #393e46;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --hover-shadow: rgba(0, 0, 0, 0.4);
            --error-bg: #4a1a1f;
            --success: #34c759;
            --warning: #ffd54f;
            --danger: #ff6b6b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-1) 0%, var(--bg-gradient-2) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 15px;
            transition: var(--transition);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        /* Header & Theme Toggle */
        header {
            text-align: center;
            margin-bottom: 25px;
            padding: 15px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo i {
            font-size: 2.2rem;
            color: var(--accent);
        }

        .logo h1 {
            font-size: 1.8rem;
            color: var(--secondary);
            font-weight: 700;
        }

        /* Install PWA Button */
        #installPWA {
            background: var(--success);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 10px auto;
            display: none;
        }

        .theme-toggle-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .theme-toggle-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .theme-toggle {
            width: 60px;
            height: 30px;
            background: var(--element-bg);
            border-radius: 50px;
            position: relative;
            cursor: pointer;
            border: 2px solid var(--border-color);
            transition: var(--transition);
        }

        .theme-toggle::before {
            content: '';
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--accent);
            top: 1px;
            left: 3px;
            transition: var(--transition);
        }

        [data-theme="dark"] .theme-toggle::before {
            transform: translateX(28px);
        }

        .theme-toggle i {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.9rem;
        }

        .theme-toggle .fa-sun {
            left: 8px;
            color: var(--warning);
        }

        .theme-toggle .fa-moon {
            right: 8px;
            color: var(--text-secondary);
        }

        .tagline {
            font-size: 1rem;
            color: var(--text-secondary);
            font-weight: 300;
            margin-bottom: 20px;
        }

        /* Language Selector */
        .language-selector {
            display: flex;
            justify-content: center;
            margin: 10px 0;
            gap: 5px;
        }

        .lang-btn {
            padding: 8px 15px;
            background: var(--element-bg);
            border: 2px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-primary);
            transition: var(--transition);
        }

        .lang-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* Search Container - Responsive */
        .search-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
            gap: 10px;
        }

        .search-box {
            position: relative;
            width: 100%;
            max-width: 500px;
            min-width: 250px;
        }

        .search-box input {
            width: 100%;
            padding: 14px 20px 14px 50px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            background: var(--card-bg);
            color: var(--text-primary);
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 8px 30px var(--shadow-color);
        }

        .search-box i {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
        }

        .search-btn, .location-btn, .voice-search-btn {
            padding: 14px 20px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }

        .search-btn {
            background: var(--primary);
            color: white;
        }

        .search-btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        .location-btn {
            background: var(--accent);
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .location-btn:hover {
            background: #2a8db8;
            transform: translateY(-2px);
        }

        .voice-search-btn {
            background: var(--warning);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .voice-search-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .voice-search-btn.listening {
            background: var(--danger);
            color: white;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .location-btn i, .voice-search-btn i {
            font-size: 0.9rem;
        }

        /* Unit Toggle */
        .unit-toggle {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
            gap: 5px;
        }

        .unit-btn {
            padding: 8px 15px;
            background: var(--element-bg);
            border: 2px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-primary);
            transition: var(--transition);
        }

        .unit-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* Feature Navigation */
        .features-nav {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 10px;
        }

        .feature-btn {
            padding: 12px 20px;
            background: var(--element-bg);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-primary);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .feature-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .feature-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* Feature Sections */
        .feature-section {
            display: none;
        }

        .feature-section.active {
            display: block;
        }

        /* Main Content - Responsive Grid */
        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        @media (min-width: 768px) {
            .main-content {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (min-width: 1200px) {
            .main-content {
                grid-template-columns: 2fr 1fr;
            }
        }

        /* Cards Styling */
        .current-weather,
        .forecast-container,
        .hourly-forecast,
        .air-quality,
        .recent-searches,
        .weather-map,
        .astronomy-data,
        .weather-alerts,
        .clothing-recommendations,
        .ai-insights,
        .weather-comparison,
        .health-recommendations,
        .weather-games,
        .weather-community,
        .analytics-dashboard,
        .activity-planner,
        .developer-api,
        .ar-weather,
        .weather-education,
        .emergency-mode {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            border: 1px solid var(--border-color);
            margin-bottom: 25px;
        }

        /* Current Weather */
        .location-info {
            margin-bottom: 20px;
        }

        .location-info h2 {
            font-size: 1.8rem;
            color: var(--secondary);
            margin-bottom: 5px;
            word-break: break-word;
        }

        .location-info .date-time {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .weather-main {
            display: flex;
            align-items: center;
            margin: 25px 0;
            flex-wrap: wrap;
            gap: 20px;
        }

        .weather-icon {
            font-size: 4rem;
            color: var(--accent);
            min-width: 80px;
        }

        .temperature {
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1;
        }

        .temperature span {
            font-size: 1.8rem;
            vertical-align: top;
        }

        .weather-description {
            font-size: 1.3rem;
            color: var(--primary);
            margin-top: 10px;
        }

        /* Weather Details Grid */
        .weather-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 25px;
        }

        @media (max-width: 480px) {
            .weather-details {
                grid-template-columns: 1fr;
            }
        }

        .detail-item {
            display: flex;
            align-items: center;
            background: var(--element-bg);
            padding: 15px;
            border-radius: 10px;
            transition: var(--transition);
        }

        .detail-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px var(--hover-shadow);
        }

        .detail-icon {
            font-size: 1.5rem;
            color: var(--accent);
            margin-right: 15px;
            min-width: 40px;
        }

        .detail-info h4 {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .detail-info p {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        /* Section Titles */
        .section-title {
            font-size: 1.3rem;
            color: var(--secondary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: var(--accent);
        }

        /* 5-Day Forecast */
        .forecast-days {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
        }

        .forecast-day {
            background: var(--element-bg);
            border-radius: 10px;
            padding: 18px;
            text-align: center;
            transition: var(--transition);
            border: 1px solid var(--border-color);
        }

        .forecast-day:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px var(--hover-shadow);
        }

        .forecast-day .day {
            font-weight: 600;
            color: var(--secondary);
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .forecast-day .date {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .forecast-day .weather-icon {
            font-size: 2.2rem;
            margin: 10px 0;
        }

        .forecast-temp {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 8px;
        }

        .temp-high {
            font-weight: 600;
            color: var(--text-primary);
        }

        .temp-low {
            color: var(--text-secondary);
        }

        /* Hourly Forecast */
        .hourly-forecast {
            margin-bottom: 25px;
        }

        .hourly-container {
            display: flex;
            overflow-x: auto;
            padding: 10px 5px;
            gap: 15px;
            scrollbar-width: thin;
            scrollbar-color: var(--accent) var(--element-bg);
        }

        .hourly-container::-webkit-scrollbar {
            height: 8px;
        }

        .hourly-container::-webkit-scrollbar-track {
            background: var(--element-bg);
            border-radius: 10px;
        }

        .hourly-container::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 10px;
        }

        .hourly-item {
            flex: 0 0 auto;
            text-align: center;
            padding: 15px;
            background: var(--element-bg);
            border-radius: 10px;
            min-width: 100px;
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .hourly-item:hover {
            transform: translateY(-3px);
        }

        .hourly-item .time {
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .hourly-item .weather-icon {
            font-size: 1.8rem;
            margin: 10px 0;
        }

        .hourly-item .temp {
            font-size: 1.2rem;
            font-weight: 600;
        }

        /* Air Quality */
        .aqi-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 25px;
        }

        @media (min-width: 576px) {
            .aqi-container {
                flex-direction: row;
            }
        }

        .aqi-value {
            font-size: 3rem;
            font-weight: 700;
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            color: white;
            flex-shrink: 0;
        }

        @media (min-width: 576px) {
            .aqi-value {
                width: 120px;
                height: 120px;
                font-size: 3.5rem;
            }
        }

        .aqi-good { background: var(--success); }
        .aqi-moderate { background: var(--warning); }
        .aqi-unhealthy { background: var(--danger); }

        .aqi-info h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
        }

        .aqi-info p {
            color: var(--text-secondary);
            line-height: 1.5;
            font-size: 0.95rem;
        }

        /* Weather Map */
        .weather-map {
            margin-bottom: 25px;
        }

        .map-container {
            width: 100%;
            height: 300px;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .map-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Astronomy Data */
        .astronomy-data {
            margin-bottom: 25px;
        }

        .astronomy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .astronomy-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: var(--element-bg);
            border-radius: 10px;
            transition: var(--transition);
        }

        .astronomy-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px var(--hover-shadow);
        }

        .astronomy-item i {
            font-size: 1.8rem;
            color: var(--accent);
            width: 40px;
        }

        .astronomy-info h4 {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .astronomy-info p {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        /* Weather Alerts */
        .weather-alerts {
            margin-bottom: 25px;
        }

        .alerts-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .alert-item {
            padding: 15px;
            border-radius: 10px;
            background: var(--warning);
            color: #000;
            border-left: 5px solid var(--danger);
        }

        .alert-item.severe {
            background: var(--danger);
            color: white;
        }

        .alert-item.info {
            background: var(--accent);
            color: white;
        }

        .alert-title {
            font-weight: 600;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alert-message {
            font-size: 0.9rem;
        }

        /* Clothing Recommendations */
        .clothing-recommendations {
            margin-bottom: 25px;
        }

        .clothing-items {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .clothing-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            background: var(--element-bg);
            border-radius: 10px;
            min-width: 100px;
            transition: var(--transition);
        }

        .clothing-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px var(--hover-shadow);
        }

        .clothing-item i {
            font-size: 2rem;
            color: var(--accent);
            margin-bottom: 10px;
        }

        .clothing-item span {
            font-size: 0.9rem;
            text-align: center;
            color: var(--text-primary);
        }

        /* Recent Searches */
        .recent-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .recent-item {
            background: var(--element-bg);
            padding: 10px 18px;
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        .recent-item:hover {
            background: var(--accent);
            color: white;
            transform: translateY(-2px);
        }

        /* AI Insights */
        .ai-insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .insight-card {
            background: var(--element-bg);
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid var(--accent);
        }

        .confidence-meter {
            height: 6px;
            background: var(--border-color);
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: var(--success);
            border-radius: 3px;
        }

        /* Weather Comparison */
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .comparison-card {
            background: var(--element-bg);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .remove-city {
            background: var(--danger);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        /* Health Recommendations */
        .health-tips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .health-tip {
            background: var(--element-bg);
            padding: 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .health-tip i {
            font-size: 1.5rem;
            color: var(--accent);
        }

        /* Gamification */
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .achievement {
            background: var(--element-bg);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            opacity: 0.5;
        }

        .achievement.unlocked {
            opacity: 1;
            border: 2px solid var(--success);
        }

        /* Weather Community */
        .user-reports {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .user-report {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: var(--element-bg);
            border-radius: 10px;
        }

        .user-report img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        /* Analytics Dashboard */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .metric-card {
            background: var(--element-bg);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            margin: 10px 0;
        }

        /* Activity Planner */
        .activity-suggestions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .activity {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: var(--element-bg);
            border-radius: 10px;
        }

        .activity.good {
            border-left: 5px solid var(--success);
        }

        .activity.bad {
            border-left: 5px solid var(--danger);
        }

        /* Developer API */
        .api-docs {
            background: var(--element-bg);
            padding: 20px;
            border-radius: 10px;
        }

        pre {
            background: #1a1a2e;
            color: white;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 10px 0;
            font-size: 0.9rem;
        }

        /* AR Weather */
        .ar-container {
            position: relative;
            width: 100%;
            height: 400px;
            border-radius: 10px;
            overflow: hidden;
        }

        #ar-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .ar-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
        }

        /* Weather Education */
        .episode-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .episode {
            background: var(--element-bg);
            padding: 15px;
            border-radius: 10px;
        }

        /* Emergency Mode */
        .emergency-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(220, 53, 69, 0.95);
            color: white;
            z-index: 9999;
            display: none;
            padding: 50px;
            text-align: center;
        }

        .emergency-mode.active {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Offline Indicator */
        .offline-indicator {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--warning);
            color: black;
            padding: 10px 20px;
            border-radius: 50px;
            display: none;
            z-index: 1000;
        }

        /* Widget Generator */
        .widget-generator {
            background: var(--element-bg);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        textarea#widget-code {
            width: 100%;
            background: #1a1a2e;
            color: white;
            padding: 15px;
            border-radius: 5px;
            border: none;
            font-family: monospace;
            resize: vertical;
            margin: 10px 0;
        }

        .copy-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Weather Trends */
        .trend-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 25px 15px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-top: 25px;
            border-top: 1px solid var(--border-color);
        }

        footer p {
            margin-bottom: 8px;
        }

        #footer-timestamp {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin: 8px 0;
            font-style: italic;
        }

        /* Loader & Error Messages */
        .loader {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loader i {
            font-size: 3rem;
            color: var(--accent);
            animation: spin 1.5s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: var(--error-bg);
            color: var(--danger);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
            border: 1px solid var(--danger);
        }

        /* Weather Animation Background */
        .weather-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.1;
            pointer-events: none;
        }

        .sunny-bg {
            background: radial-gradient(circle at 20% 50%, #ffeb3b 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, #ff9800 0%, transparent 50%);
        }

        .rainy-bg {
            background: linear-gradient(45deg, #616161 25%, transparent 25%),
                        linear-gradient(-45deg, #616161 25%, transparent 25%),
                        linear-gradient(45deg, transparent 75%, #616161 75%),
                        linear-gradient(-45deg, transparent 75%, #616161 75%);
            background-size: 20px 20px;
            animation: rain-bg 20s linear infinite;
        }

        @keyframes rain-bg {
            0% { background-position: 0 0; }
            100% { background-position: 40px 40px; }
        }

        .cloudy-bg {
            background: radial-gradient(circle at 30% 50%, #78909c 0%, transparent 50%),
                        radial-gradient(circle at 70% 30%, #546e7a 0%, transparent 50%);
        }

        /* Export Options */
        .export-options {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .export-btn {
            padding: 10px 20px;
            background: var(--element-bg);
            border: 2px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-primary);
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .export-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* Mobile Optimization */
        @media (max-width: 768px) {
            .header-top {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            .logo h1 {
                font-size: 1.6rem;
            }
            
            .search-container {
                flex-direction: column;
                align-items: center;
            }
            
            .search-box {
                max-width: 100%;
            }
            
            .search-btn, .location-btn, .voice-search-btn {
                width: 100%;
                max-width: 500px;
                justify-content: center;
            }
            
            .temperature {
                font-size: 3rem;
            }
            
            .weather-icon {
                font-size: 3.5rem;
            }
            
            .astronomy-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .current-weather,
            .forecast-container,
            .hourly-forecast,
            .air-quality,
            .recent-searches,
            .weather-map,
            .astronomy-data,
            .weather-alerts,
            .clothing-recommendations {
                padding: 20px 15px;
            }
            
            .location-info h2 {
                font-size: 1.5rem;
            }
            
            .weather-main {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .hourly-item {
                min-width: 90px;
                padding: 12px;
            }
        }

        /* Print Styles */
        @media print {
            .theme-toggle-container,
            .search-container,
            .unit-toggle,
            .recent-searches,
            footer,
            .export-options {
                display: none;
            }
            
            body {
                background: white !important;
                color: black !important;
            }
            
            .current-weather,
            .forecast-container,
            .hourly-forecast,
            .air-quality {
                box-shadow: none;
                border: 1px solid #ccc;
            }
        }
    </style>
</head>
<body>
    <!-- Emergency Mode -->
    <div class="emergency-mode" id="emergency-mode">
        <i class="fas fa-exclamation-triangle" style="font-size: 4rem; margin-bottom: 20px;"></i>
        <h2 style="color: white; margin-bottom: 20px;">SEVERE WEATHER ALERT</h2>
        <div id="emergency-content" style="max-width: 600px;">
            <!-- Emergency content will be loaded here -->
        </div>
        <button onclick="shareLocationWithEmergency()" style="background: white; color: var(--danger); padding: 15px 30px; border: none; border-radius: 10px; margin-top: 30px; cursor: pointer;">
            <i class="fas fa-sos"></i> Share Location with Emergency Services
        </button>
        <button onclick="exitEmergencyMode()" style="background: transparent; color: white; border: 2px solid white; padding: 10px 20px; border-radius: 10px; margin-top: 20px; cursor: pointer;">
            Exit Emergency Mode
        </button>
    </div>

    <!-- Offline Indicator -->
    <div class="offline-indicator" id="offline-indicator">
        <i class="fas fa-wifi-slash"></i> You are currently offline
    </div>

    <!-- Weather Background Animation -->
    <div class="weather-background sunny-bg" id="weather-background"></div>
    
    <div class="container">
        <header>
            <div class="header-top">
                <div class="logo">
                    <i class="fas fa-cloud-sun"></i>
                    <h1>WeatherCast Pro</h1>
                </div>
                <div class="theme-toggle-container">
                    <span class="theme-toggle-label">Dark Mode</span>
                    <div class="theme-toggle" id="theme-toggle">
                        <i class="fas fa-sun"></i>
                        <i class="fas fa-moon"></i>
                    </div>
                </div>
            </div>
            <p class="tagline">Live weather forecasts with AI-powered predictions</p>
            
            <!-- Install PWA Button -->
            <button id="installPWA">
                <i class="fas fa-download"></i> Install App
            </button>
            
            <!-- Language Selector -->
            <div class="language-selector">
                <button class="lang-btn active" onclick="setLanguage('en')">EN</button>
                <button class="lang-btn" onclick="setLanguage('es')">ES</button>
                <button class="lang-btn" onclick="setLanguage('fr')">FR</button>
                <button class="lang-btn" onclick="setLanguage('de')">DE</button>
            </div>
            
            <div class="search-container">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="city-input" placeholder="Enter city name (e.g., New York, London, Tokyo)">
                </div>
                <button class="search-btn" id="search-btn">Search</button>
                <button class="location-btn" id="location-btn">
                    <i class="fas fa-location-arrow"></i>
                    <span>My Location</span>
                </button>
                <button class="voice-search-btn" id="voice-search-btn">
                    <i class="fas fa-microphone"></i>
                    <span>Voice Search</span>
                </button>
            </div>
            
            <div class="unit-toggle">
                <button class="unit-btn active" id="celsius-btn">°C</button>
                <button class="unit-btn" id="fahrenheit-btn">°F</button>
            </div>

            <!-- Features Navigation -->
            <div class="features-nav">
                <button class="feature-btn active" onclick="showFeature('weather')">
                    <i class="fas fa-cloud-sun"></i> Weather
                </button>
                <button class="feature-btn" onclick="showFeature('ai')">
                    <i class="fas fa-brain"></i> AI Insights
                </button>
                <!-- <button class="feature-btn" onclick="showFeature('comparison')">
                    <i class="fas fa-balance-scale"></i> Compare
                </button> -->
                <button class="feature-btn" onclick="showFeature('health')">
                    <i class="fas fa-heartbeat"></i> Health Tips
                </button>
                <button class="feature-btn" onclick="showFeature('gamification')">
                    <i class="fas fa-gamepad"></i> Challenges
                </button>
                <button class="feature-btn" onclick="showFeature('widget')">
                    <i class="fas fa-code"></i> Widget
                </button>
            </div>
        </header>

        <div class="loader" id="loader">
            <i class="fas fa-spinner"></i>
            <p>Loading weather data...</p>
        </div>

        <div class="error-message" id="error-message"></div>

        <!-- Main Weather Section -->
        <div class="feature-section active" id="weather-section">
            <div class="main-content" id="main-content">
                <div class="current-weather">
                    <div class="location-info">
                        <h2 id="city-name">New York, US</h2>
                        <p class="date-time" id="current-date-time">Monday, June 12, 2023 • 14:30</p>
                    </div>
                    
                    <div class="weather-main">
                        <div class="weather-icon">
                            <i class="fas fa-sun" id="weather-icon"></i>
                        </div>
                        <div>
                            <div class="temperature">
                                <span id="current-temp">24</span>°<span id="temp-unit">C</span>
                            </div>
                            <p class="weather-description" id="weather-description">Sunny</p>
                        </div>
                    </div>
                    
                    <div class="weather-details">
                        <div class="detail-item">
                            <div class="detail-icon">
                                <i class="fas fa-wind"></i>
                            </div>
                            <div class="detail-info">
                                <h4 data-i18n="wind">Wind Speed</h4>
                                <p id="wind-speed">12 km/h</p>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">
                                <i class="fas fa-tint"></i>
                            </div>
                            <div class="detail-info">
                                <h4 data-i18n="humidity">Humidity</h4>
                                <p id="humidity">65%</p>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">
                                <i class="fas fa-temperature-high"></i>
                            </div>
                            <div class="detail-info">
                                <h4 data-i18n="feelsLike">Feels Like</h4>
                                <p id="feels-like">26°C</p>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">
                                <i class="fas fa-compress-alt"></i>
                            </div>
                            <div class="detail-info">
                                <h4 data-i18n="pressure">Pressure</h4>
                                <p id="pressure">1013 hPa</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="forecast-container">
                    <h3 class="section-title"><i class="fas fa-calendar-alt"></i> 5-Day Forecast</h3>
                    <div class="forecast-days" id="forecast-days">
                        <!-- Forecast days will be generated by JS -->
                    </div>
                </div>
            </div>
            
            <div class="hourly-forecast">
                <h3 class="section-title"><i class="fas fa-clock"></i> 24-Hour Forecast</h3>
                <div class="hourly-container" id="hourly-forecast">
                    <!-- Hourly forecast will be generated by JS -->
                </div>
            </div>
            
            <div class="weather-map">
                <h3 class="section-title"><i class="fas fa-map"></i> Interactive Weather Map</h3>
                <div class="map-container">
                    <iframe id="weather-map" src="https://embed.windy.com/embed2.html?lat=40.7128&lon=-74.0060&zoom=5&level=surface&overlay=wind&menu=&message=true&marker=true&calendar=now&pressure=&type=map&location=coordinates&detail=true&metricWind=default&metricTemp=default&radarRange=-1" frameborder="0"></iframe>
                </div>
            </div>
            
            <div class="astronomy-data">
                <h3 class="section-title"><i class="fas fa-star"></i> Astronomy Data</h3>
                <div class="astronomy-grid">
                    <div class="astronomy-item">
                        <i class="fas fa-sunrise"></i>
                        <div class="astronomy-info">
                            <h4 data-i18n="sunrise">Sunrise</h4>
                            <p id="sunrise-time">6:45 AM</p>
                        </div>
                    </div>
                    <div class="astronomy-item">
                        <i class="fas fa-sunset"></i>
                        <div class="astronomy-info">
                            <h4 data-i18n="sunset">Sunset</h4>
                            <p id="sunset-time">7:30 PM</p>
                        </div>
                    </div>
                    <div class="astronomy-item">
                        <i class="fas fa-moon"></i>
                        <div class="astronomy-info">
                            <h4 data-i18n="moonPhase">Moon Phase</h4>
                            <p id="moon-phase">Waxing Crescent</p>
                        </div>
                    </div>
                    <div class="astronomy-item">
                        <i class="fas fa-sun"></i>
                        <div class="astronomy-info">
                            <h4 data-i18n="dayLength">Day Length</h4>
                            <p id="day-length">12h 45m</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="air-quality">
                <h3 class="section-title"><i class="fas fa-wind"></i> Air Quality Index</h3>
                <div class="aqi-container">
                    <div class="aqi-value aqi-good" id="aqi-value">42</div>
                    <div class="aqi-info">
                        <h3 id="aqi-status">Good</h3>
                        <p id="aqi-description">Air quality is satisfactory, and air pollution poses little or no risk.</p>
                    </div>
                </div>
            </div>
            
            <div class="weather-alerts">
                <h3 class="section-title"><i class="fas fa-exclamation-triangle"></i> Weather Alerts</h3>
                <div class="alerts-container" id="weather-alerts">
                    <!-- Alerts will be generated by JS -->
                </div>
            </div>
            
            <div class="clothing-recommendations">
                <h3 class="section-title"><i class="fas fa-tshirt"></i> What to Wear</h3>
                <div class="clothing-items" id="clothing-items">
                    <!-- Clothing items will be generated by JS -->
                </div>
            </div>
            
            <div class="recent-searches">
                <h3 class="section-title"><i class="fas fa-history"></i> Recent Searches</h3>
                <div class="recent-list" id="recent-searches">
                    <!-- Recent searches will be generated by JS -->
                </div>
            </div>
            
            <div class="export-options">
                <button class="export-btn" id="export-pdf">
                    <i class="fas fa-file-pdf"></i> Export as PDF
                </button>
                <button class="export-btn" id="share-weather">
                    <i class="fas fa-share-alt"></i> Share Weather
                </button>
                <button class="export-btn" id="save-location">
                    <i class="fas fa-bookmark"></i> Save Location
                </button>
            </div>
        </div>

        <!-- AI Insights Section -->
        <div class="feature-section ai-insights" id="ai-section">
            <h2 class="section-title"><i class="fas fa-brain"></i> AI Weather Predictions & Insights</h2>
            <div class="ai-insights-grid" id="ai-insights-content">
                <!-- AI insights will be generated here -->
            </div>
            
            <h3 class="section-title"><i class="fas fa-chart-line"></i> Historical Weather & Trends</h3>
            <div class="weather-trends">
                <div class="trend-stats" id="trend-stats">
                    <div>Avg High: <span id="avg-high">24°C</span></div>
                    <div>Avg Low: <span id="avg-low">18°C</span></div>
                    <div>Rainy Days: <span id="rainy-days">5</span></div>
                </div>
            </div>
        </div>

        <!-- Weather Comparison Section -->
        <div class="feature-section weather-comparison" id="comparison-section">
            <h2 class="section-title"><i class="fas fa-balance-scale"></i> Weather Comparison Tool</h2>
            <div class="comparison-controls">
                <div class="search-box" style="max-width: 400px; margin-bottom: 20px;">
                    <i class="fas fa-search"></i>
                    <input type="text" id="compare-city-input" placeholder="Add city to compare...">
                    <button onclick="addCityToCompare()" style="margin-left: 10px;">Add</button>
                </div>
            </div>
            <div class="comparison-grid" id="comparison-grid">
                <!-- Comparison cards will be generated here -->
            </div>
        </div>

        <!-- Health Recommendations Section -->
        <div class="feature-section health-recommendations" id="health-section">
            <h2 class="section-title"><i class="fas fa-heartbeat"></i> Health & Wellness Recommendations</h2>
            <div class="health-tips-grid" id="health-tips">
                <!-- Health tips will be generated here -->
            </div>
            
            <h3 class="section-title"><i class="fas fa-calendar-check"></i> Weather-based Activity Planner</h3>
            <div class="activity-planner" id="activity-planner">
                <!-- Activity suggestions will be generated here -->
            </div>
        </div>

        <!-- Gamification Section -->
        <div class="feature-section weather-games" id="gamification-section">
            <h2 class="section-title"><i class="fas fa-gamepad"></i> Weather Gamification</h2>
            <div class="achievements-grid" id="achievements-grid">
                <!-- Achievements will be generated here -->
            </div>
            
            <h3 class="section-title"><i class="fas fa-question-circle"></i> Daily Weather Quiz</h3>
            <div class="weather-quiz" id="weather-quiz">
                <!-- Quiz will be generated here -->
            </div>
        </div>

        <!-- Widget Generator Section -->
        <div class="feature-section" id="widget-section">
            <h2 class="section-title"><i class="fas fa-code"></i> Weather Widget Generator</h2>
            <div class="widget-generator">
                <h4>Embeddable Weather Widget</h4>
                <textarea id="widget-code" readonly>
<iframe src="https://weathercastpro.com/widget?city=New+York&theme=light" width="300" height="400" frameborder="0" style="border-radius: 10px;"></iframe>
                </textarea>
                <button onclick="copyWidgetCode()" class="copy-btn">
                    <i class="fas fa-copy"></i> Copy Widget Code
                </button>
                <div style="margin-top: 20px;">
                    <p><strong>Customization Options:</strong></p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                        <button onclick="updateWidgetCode('New York')" class="export-btn">New York</button>
                        <button onclick="updateWidgetCode('London')" class="export-btn">London</button>
                        <button onclick="updateWidgetCode('Tokyo')" class="export-btn">Tokyo</button>
                        <button onclick="updateWidgetCode('Sydney')" class="export-btn">Sydney</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Additional Feature Sections (Hidden by default) -->
        <div class="weather-community" style="display: none;" id="social-section">
            <h3 class="section-title"><i class="fas fa-users"></i> Social Weather Sharing</h3>
            <div class="user-reports" id="user-reports">
                <!-- User reports will be generated here -->
            </div>
            <button onclick="shareMyWeather()" class="export-btn" style="margin-top: 20px;">
                <i class="fas fa-camera"></i> Share Current Weather
            </button>
        </div>

        <div class="analytics-dashboard" style="display: none;" id="analytics-section">
            <h3 class="section-title"><i class="fas fa-chart-line"></i> Advanced Analytics Dashboard</h3>
            <div class="analytics-grid" id="analytics-grid">
                <!-- Analytics cards will be generated here -->
            </div>
        </div>

        <div class="developer-api" style="display: none;" id="api-section">
            <h3 class="section-title"><i class="fas fa-code"></i> Weather Data API for Developers</h3>
            <div class="api-docs">
                <pre><code>
// Get current weather
GET /api/v1/weather?city=London&units=metric

// Response
{
  "city": "London",
  "temperature": 18.5,
  "condition": "Partly Cloudy",
  "humidity": 65,
  "forecast": [...]
}
                </code></pre>
                <button onclick="generateApiKey()" class="export-btn">
                    <i class="fas fa-key"></i> Get API Key
                </button>
            </div>
        </div>

        <div class="ar-weather" style="display: none;" id="ar-section">
            <h3 class="section-title"><i class="fas fa-vr-cardboard"></i> Augmented Reality Weather View</h3>
            <div class="ar-container">
                <video id="ar-video" autoplay></video>
                <div class="ar-overlay">
                    <div class="ar-temp">24°C</div>
                    <div class="ar-wind">12 km/h ←</div>
                    <div class="ar-clouds">☁️ 40% coverage</div>
                </div>
            </div>
            <button onclick="startAR()" class="export-btn" style="margin-top: 20px;">
                <i class="fas fa-camera"></i> Launch AR Mode
            </button>
        </div>

        <div class="weather-education" style="display: none;" id="education-section">
            <h3 class="section-title"><i class="fas fa-podcast"></i> Weather Podcast & Educational Content</h3>
            <div class="episode-list" id="episode-list">
                <!-- Episodes will be generated here -->
            </div>
        </div>

        <footer>
            <p>WeatherCast Pro • Data provided by World Weather Online • © 2026 All rights reserved</p>
            <p id="footer-timestamp">Last updated: Loading time...</p>
            <p>This app uses live weather data and AI predictions for accurate forecasting.</p>
        </footer>
    </div>

    <script>
        // =========== PWA & OFFLINE SUPPORT ===========
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registered:', registration);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }

        // PWA Install Prompt
        let deferredPrompt;
        const installButton = document.getElementById('installPWA');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installButton.style.display = 'flex';
            
            installButton.addEventListener('click', () => {
                installButton.style.display = 'none';
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted install');
                    }
                    deferredPrompt = null;
                });
            });
        });

        // Offline Detection
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);

        function updateOnlineStatus() {
            const offlineIndicator = document.getElementById('offline-indicator');
            if (!navigator.onLine) {
                offlineIndicator.style.display = 'block';
                loadCachedWeatherData();
            } else {
                offlineIndicator.style.display = 'none';
            }
        }

        function loadCachedWeatherData() {
            const cachedData = localStorage.getItem('cachedWeatherData');
            if (cachedData) {
                const data = JSON.parse(cachedData);
                updateCurrentWeather(data);
                showNotification('Showing cached weather data (offline mode)');
            }
        }

        // =========== INTERNATIONALIZATION ===========
        const translations = {
            en: {
                search: 'Search',
                temperature: 'Temperature',
                feelsLike: 'Feels Like',
                humidity: 'Humidity',
                wind: 'Wind Speed',
                pressure: 'Pressure',
                sunrise: 'Sunrise',
                sunset: 'Sunset',
                moonPhase: 'Moon Phase',
                dayLength: 'Day Length',
                airQuality: 'Air Quality',
                good: 'Good',
                moderate: 'Moderate',
                unhealthy: 'Unhealthy',
                weatherAlerts: 'Weather Alerts',
                noAlerts: 'No Active Alerts',
                whatToWear: 'What to Wear',
                recentSearches: 'Recent Searches'
            },
            es: {
                search: 'Buscar',
                temperature: 'Temperatura',
                feelsLike: 'Sensación Térmica',
                humidity: 'Humedad',
                wind: 'Velocidad del Viento',
                pressure: 'Presión',
                sunrise: 'Amanecer',
                sunset: 'Atardecer',
                moonPhase: 'Fase Lunar',
                dayLength: 'Duración del Día',
                airQuality: 'Calidad del Aire',
                good: 'Buena',
                moderate: 'Moderada',
                unhealthy: 'Mala',
                weatherAlerts: 'Alertas Meteorológicas',
                noAlerts: 'Sin Alertas Activas',
                whatToWear: 'Qué Ponerse',
                recentSearches: 'Búsquedas Recientes'
            },
            fr: {
                search: 'Rechercher',
                temperature: 'Température',
                feelsLike: 'Ressenti',
                humidity: 'Humidité',
                wind: 'Vitesse du Vent',
                pressure: 'Pression',
                sunrise: 'Lever du Soleil',
                sunset: 'Coucher du Soleil',
                moonPhase: 'Phase de la Lune',
                dayLength: 'Durée du Jour',
                airQuality: 'Qualité de l\'Air',
                good: 'Bonne',
                moderate: 'Modérée',
                unhealthy: 'Mauvaise',
                weatherAlerts: 'Alertes Météo',
                noAlerts: 'Aucune Alerte Active',
                whatToWear: 'Quoi Porter',
                recentSearches: 'Recherches Récentes'
            },
            de: {
                search: 'Suchen',
                temperature: 'Temperatur',
                feelsLike: 'Gefühlt',
                humidity: 'Luftfeuchtigkeit',
                wind: 'Windgeschwindigkeit',
                pressure: 'Luftdruck',
                sunrise: 'Sonnenaufgang',
                sunset: 'Sonnenuntergang',
                moonPhase: 'Mondphase',
                dayLength: 'Tageslänge',
                airQuality: 'Luftqualität',
                good: 'Gut',
                moderate: 'Mäßig',
                unhealthy: 'Ungesund',
                weatherAlerts: 'Wetterwarnungen',
                noAlerts: 'Keine aktiven Warnungen',
                whatToWear: 'Was anziehen',
                recentSearches: 'Letzte Suchen'
            }
        };

        let currentLang = localStorage.getItem('language') || 'en';

        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('language', lang);
            updateAllText();
            
            // Update language buttons
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function updateAllText() {
            // Update all translatable text elements
            const elements = document.querySelectorAll('[data-i18n]');
            elements.forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[currentLang][key]) {
                    element.textContent = translations[currentLang][key];
                }
            });
        }

        // =========== FEATURE NAVIGATION ===========
        function showFeature(feature) {
            // Hide all feature sections
            document.querySelectorAll('.feature-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all feature buttons
            document.querySelectorAll('.feature-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected feature
            document.getElementById(`${feature}-section`).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }

        // =========== AI INSIGHTS ===========
        function generateAIInsights(weatherData) {
            const container = document.getElementById('ai-insights-content');
            container.innerHTML = '';
            
            const insights = [
                {
                    icon: 'fa-thermometer-half',
                    title: 'Temperature Prediction',
                    insight: getTemperatureInsight(weatherData),
                    confidence: 85
                },
                {
                    icon: 'fa-cloud-rain',
                    title: 'Rain Forecast',
                    insight: getRainInsight(weatherData),
                    confidence: 78
                },
                {
                    icon: 'fa-wind',
                    title: 'Wind Analysis',
                    insight: getWindInsight(weatherData),
                    confidence: 92
                },
                {
                    icon: 'fa-sun',
                    title: 'UV Risk Assessment',
                    insight: getUVInsightText(weatherData),
                    confidence: 88
                }
            ];
            
            insights.forEach(insight => {
                const insightHTML = `
                    <div class="insight-card">
                        <h4><i class="fas ${insight.icon}"></i> ${insight.title}</h4>
                        <p>${insight.insight}</p>
                        <div class="confidence-meter">
                            <div class="confidence-fill" style="width: ${insight.confidence}%"></div>
                        </div>
                        <small>Confidence: ${insight.confidence}%</small>
                    </div>
                `;
                container.innerHTML += insightHTML;
            });
        }

        function getTemperatureInsight(data) {
            const temps = data.weather.map(day => parseInt(day.avgtempC));
            const currentTemp = parseInt(data.current_condition[0].temp_C);
            const avgTemp = temps.reduce((a, b) => a + b) / temps.length;
            
            if (currentTemp > avgTemp + 3) {
                return "Temperature is significantly above average. Expect continued warm conditions.";
            } else if (currentTemp < avgTemp - 3) {
                return "Temperature is below average. Cooling trend expected to continue.";
            } else {
                return "Temperature stable near seasonal averages.";
            }
        }

        function getRainInsight(data) {
            const chanceOfRain = data.weather[0].hourly.reduce((max, hour) => 
                Math.max(max, parseInt(hour.chanceofrain) || 0), 0);
            
            if (chanceOfRain > 70) {
                return "High probability of precipitation. Carry an umbrella.";
            } else if (chanceOfRain > 40) {
                return "Moderate chance of rain. Stay prepared.";
            } else {
                return "Low precipitation risk. Dry conditions expected.";
            }
        }

        function getWindInsight(data) {
            const windSpeed = parseInt(data.current_condition[0].windspeedKmph);
            
            if (windSpeed > 30) {
                return "Strong winds expected. Secure loose objects outdoors.";
            } else if (windSpeed > 20) {
                return "Breezy conditions. Good for wind-based activities.";
            } else {
                return "Light winds. Calm conditions prevailing.";
            }
        }

        function getUVInsightText(data) {
            const uvIndex = parseInt(data.current_condition[0].uvIndex) || 5;
            
            if (uvIndex > 8) {
                return "Extreme UV levels. Maximum protection required.";
            } else if (uvIndex > 6) {
                return "High UV radiation. Sunscreen recommended.";
            } else {
                return "Moderate UV levels. Standard protection sufficient.";
            }
        }

        // =========== WEATHER COMPARISON ===========
        let comparedCities = JSON.parse(localStorage.getItem('comparedCities')) || [];
        
        function addCityToCompare() {
            const input = document.getElementById('compare-city-input');
            const city = input.value.trim();
            
            if (city && !comparedCities.includes(city)) {
                comparedCities.push(city);
                localStorage.setItem('comparedCities', JSON.stringify(comparedCities));
                updateComparisonGrid();
                input.value = '';
            }
        }
        
        function removeCityFromCompare(city) {
            comparedCities = comparedCities.filter(c => c !== city);
            localStorage.setItem('comparedCities', JSON.stringify(comparedCities));
            updateComparisonGrid();
        }
        
        function updateComparisonGrid() {
            const grid = document.getElementById('comparison-grid');
            grid.innerHTML = '';
            
            comparedCities.forEach(city => {
                const cardHTML = `
                    <div class="comparison-card">
                        <h4>${city}</h4>
                        <div class="weather-icon">
                            <i class="fas fa-cloud-sun"></i>
                        </div>
                        <div class="temp">24°C</div>
                        <div class="condition">Partly Cloudy</div>
                        <button class="remove-city" onclick="removeCityFromCompare('${city}')">
                            Remove
                        </button>
                    </div>
                `;
                grid.innerHTML += cardHTML;
            });
        }

        // =========== HEALTH RECOMMENDATIONS ===========
        function generateHealthTips(weatherData) {
            const container = document.getElementById('health-tips');
            container.innerHTML = '';
            
            const current = weatherData.current_condition[0];
            const temp = parseInt(current.temp_C);
            const humidity = parseInt(current.humidity);
            const uvIndex = parseInt(current.uvIndex) || 5;
            const windSpeed = parseInt(current.windspeedKmph);
            
            const tips = [];
            
            // UV Protection
            if (uvIndex > 6) {
                tips.push({
                    icon: 'fa-sun',
                    tip: 'High UV index detected. Apply SPF 30+ sunscreen every 2 hours.'
                });
            }
            
            // Humidity
            if (humidity > 70) {
                tips.push({
                    icon: 'fa-tint',
                    tip: 'High humidity may affect breathing. Stay hydrated and avoid strenuous activities.'
                });
            } else if (humidity < 30) {
                tips.push({
                    icon: 'fa-wind',
                    tip: 'Low humidity can cause dry skin. Use moisturizer and drink plenty of water.'
                });
            }
            
            // Temperature
            if (temp > 30) {
                tips.push({
                    icon: 'fa-thermometer-full',
                    tip: 'High temperature alert. Stay in cool areas and drink extra fluids.'
                });
            } else if (temp < 10) {
                tips.push({
                    icon: 'fa-thermometer-empty',
                    tip: 'Cold weather warning. Dress in layers to maintain body heat.'
                });
            }
            
            // Wind
            if (windSpeed > 25) {
                tips.push({
                    icon: 'fa-wind',
                    tip: 'Strong winds may cause eye irritation. Consider wearing protective eyewear.'
                });
            }
            
            // Generate tips HTML
            tips.forEach(tip => {
                const tipHTML = `
                    <div class="health-tip">
                        <i class="fas ${tip.icon}"></i>
                        <div>
                            <p>${tip.tip}</p>
                        </div>
                    </div>
                `;
                container.innerHTML += tipHTML;
            });
            
            // Generate activity planner
            generateActivityPlanner(weatherData);
        }

        function generateActivityPlanner(weatherData) {
            const container = document.getElementById('activity-planner');
            const current = weatherData.current_condition[0];
            const temp = parseInt(current.temp_C);
            const condition = current.weatherDesc[0].value.toLowerCase();
            const windSpeed = parseInt(current.windspeedKmph);
            
            container.innerHTML = '';
            
            const activities = [];
            
            if (temp > 20 && !condition.includes('rain')) {
                activities.push({
                    icon: 'fa-biking',
                    name: 'Cycling',
                    suitability: 'Excellent',
                    reason: 'Perfect temperature and dry conditions'
                });
            }
            
            if (temp > 15 && temp < 25 && windSpeed < 20) {
                activities.push({
                    icon: 'fa-hiking',
                    name: 'Hiking',
                    suitability: 'Good',
                    reason: 'Mild temperature and light winds'
                });
            }
            
            if (condition.includes('rain')) {
                activities.push({
                    icon: 'fa-film',
                    name: 'Indoor Movies',
                    suitability: 'Recommended',
                    reason: 'Rainy weather - perfect for indoor entertainment'
                });
            }
            
            if (temp < 10) {
                activities.push({
                    icon: 'fa-hot-tub',
                    name: 'Hot Beverages',
                    suitability: 'Perfect',
                    reason: 'Cold weather calls for warm drinks'
                });
            }
            
            activities.forEach(activity => {
                const activityHTML = `
                    <div class="activity ${activity.suitability.toLowerCase()}">
                        <i class="fas ${activity.icon}"></i>
                        <div>
                            <strong>${activity.name}</strong>
                            <span class="suitability">${activity.suitability}</span>
                            <p>${activity.reason}</p>
                        </div>
                    </div>
                `;
                container.innerHTML += activityHTML;
            });
        }

        // =========== GAMIFICATION ===========
        const achievements = [
            { id: 'sun_seeker', title: 'Sun Seeker', description: 'Check weather for 7 sunny days', icon: 'fa-sun', unlocked: true },
            { id: 'rain_warrior', title: 'Rain Warrior', description: 'Experience 5 rainstorms', icon: 'fa-umbrella', unlocked: false },
            { id: 'wind_rider', title: 'Wind Rider', description: 'Check weather on 3 windy days', icon: 'fa-wind', unlocked: true },
            { id: 'temperature_master', title: 'Temperature Master', description: 'Track temperature for 30 days', icon: 'fa-thermometer-full', unlocked: false },
            { id: 'storm_chaser', title: 'Storm Chaser', description: 'Witness 2 thunderstorms', icon: 'fa-bolt', unlocked: false },
            { id: 'weather_expert', title: 'Weather Expert', description: 'Use all features of the app', icon: 'fa-graduation-cap', unlocked: false }
        ];
        
        function loadAchievements() {
            const grid = document.getElementById('achievements-grid');
            grid.innerHTML = '';
            
            achievements.forEach(achievement => {
                const achievementHTML = `
                    <div class="achievement ${achievement.unlocked ? 'unlocked' : ''}">
                        <i class="fas ${achievement.icon}"></i>
                        <h4>${achievement.title}</h4>
                        <p>${achievement.description}</p>
                    </div>
                `;
                grid.innerHTML += achievementHTML;
            });
        }

        function loadWeatherQuiz() {
            const container = document.getElementById('weather-quiz');
            const quiz = {
                question: "What does cumulonimbus clouds indicate?",
                options: ["Thunderstorms", "Clear Sky", "Light Rain", "Fog"],
                correct: 0
            };
            
            container.innerHTML = `
                <h4>Daily Weather Quiz</h4>
                <p>${quiz.question}</p>
                <div class="quiz-options" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                    ${quiz.options.map((option, index) => `
                        <button onclick="checkQuizAnswer(${index}, ${quiz.correct})" 
                                class="export-btn" 
                                style="text-align: left;">
                            ${option}
                        </button>
                    `).join('')}
                </div>
            `;
        }
        
        function checkQuizAnswer(selected, correct) {
            const buttons = document.querySelectorAll('.quiz-options button');
            buttons.forEach(button => button.disabled = true);
            
            if (selected === correct) {
                event.target.style.background = 'var(--success)';
                event.target.style.color = 'white';
                showNotification('Correct! Cumulonimbus clouds indicate thunderstorms.');
            } else {
                event.target.style.background = 'var(--danger)';
                event.target.style.color = 'white';
                buttons[correct].style.background = 'var(--success)';
                buttons[correct].style.color = 'white';
                showNotification('Incorrect. Cumulonimbus clouds indicate thunderstorms.');
            }
        }

        // =========== WIDGET GENERATOR ===========
        function updateWidgetCode(city) {
            const widgetCode = `<iframe src="https://weathercastpro.com/widget?city=${encodeURIComponent(city)}&theme=light" width="300" height="400" frameborder="0" style="border-radius: 10px;"></iframe>`;
            document.getElementById('widget-code').value = widgetCode;
            showNotification(`Widget code updated for ${city}`);
        }
        
        function copyWidgetCode() {
            const codeTextarea = document.getElementById('widget-code');
            codeTextarea.select();
            document.execCommand('copy');
            
            const originalText = event.target.innerHTML;
            event.target.innerHTML = '<i class="fas fa-check"></i> Copied!';
            setTimeout(() => {
                event.target.innerHTML = originalText;
            }, 2000);
            
            showNotification('Widget code copied to clipboard');
        }

        // =========== SOCIAL FEATURES ===========
        function shareMyWeather() {
            const city = document.getElementById('city-name').textContent;
            const temp = document.getElementById('current-temp').textContent;
            const unit = document.getElementById('temp-unit').textContent;
            const description = document.getElementById('weather-description').textContent;
            
            const text = `Current weather in ${city}: ${temp}°${unit} and ${description}. Check it out on WeatherCast Pro!`;
            
            if (navigator.share) {
                navigator.share({
                    title: `Weather in ${city}`,
                    text: text,
                    url: window.location.href
                });
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(text).then(() => {
                    showNotification('Weather info copied to clipboard!');
                });
            }
        }

        // =========== DEVELOPER API ===========
        function generateApiKey() {
            const apiKey = 'wcp_' + Math.random().toString(36).substr(2, 16) + Date.now().toString(36);
            showNotification(`API Key Generated: ${apiKey}`);
            
            // Save to localStorage
            localStorage.setItem('apiKey', apiKey);
        }

        // =========== AR WEATHER VIEW ===========
        let arStream = null;
        
        async function startAR() {
            try {
                const video = document.getElementById('ar-video');
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' }
                });
                
                video.srcObject = stream;
                arStream = stream;
                
                showNotification('AR mode activated. Point camera at sky.');
            } catch (error) {
                console.error('AR error:', error);
                showError('Unable to access camera for AR mode.');
            }
        }

        // =========== EMERGENCY MODE ===========
        function activateEmergencyMode(alertData) {
            const emergencyMode = document.getElementById('emergency-mode');
            const emergencyContent = document.getElementById('emergency-content');
            
            emergencyContent.innerHTML = `
                <h3>${alertData.title}</h3>
                <p style="font-size: 1.2rem; margin: 20px 0;">${alertData.message}</p>
                <div class="safety-instructions" style="text-align: left; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <strong>Safety Instructions:</strong>
                    <ul style="margin-top: 10px; padding-left: 20px;">
                        ${alertData.safetyInstructions.map(instruction => `<li>${instruction}</li>`).join('')}
                    </ul>
                </div>
            `;
            
            emergencyMode.classList.add('active');
            
            // Make alert sound
            try {
                const audio = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-warning-alarm-buzzer-937.mp3');
                audio.play();
            } catch (e) {
                console.log('Audio play failed:', e);
            }
        }
        
        function exitEmergencyMode() {
            document.getElementById('emergency-mode').classList.remove('active');
        }
        
        function shareLocationWithEmergency() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const { latitude, longitude } = position.coords;
                    showNotification(`Location shared with emergency services: ${latitude.toFixed(4)}, ${longitude.toFixed(4)}`);
                });
            }
        }

        function checkEmergencyAlerts() {
            // Mock emergency alerts - in production, this would fetch from an API
            const mockAlerts = [
                {
                    active: Math.random() > 0.9, // 10% chance of alert
                    title: "Severe Thunderstorm Warning",
                    message: "Tornado warning in effect until 5:00 PM",
                    safetyInstructions: [
                        "Go to basement or interior room",
                        "Avoid windows",
                        "Monitor local news",
                        "Stay away from electrical equipment"
                    ]
                }
            ];
            
            const activeAlert = mockAlerts.find(alert => alert.active);
            if (activeAlert) {
                activateEmergencyMode(activeAlert);
            }
        }

        // =========== WEATHER EDUCATION ===========
        function loadWeatherEducation() {
            const container = document.getElementById('episode-list');
            const episodes = [
                {
                    title: "Understanding Hurricanes",
                    description: "Learn how hurricanes form and their impact.",
                    duration: "15 min"
                },
                {
                    title: "Cloud Types Explained",
                    description: "Identify different cloud formations and what they mean.",
                    duration: "12 min"
                },
                {
                    title: "Climate Change Basics",
                    description: "Understanding the science behind climate change.",
                    duration: "20 min"
                }
            ];
            
            container.innerHTML = episodes.map(episode => `
                <div class="episode">
                    <h4>${episode.title}</h4>
                    <p>${episode.description}</p>
                    <small>Duration: ${episode.duration}</small>
                    <button class="export-btn" style="margin-top: 10px;">
                        <i class="fas fa-play"></i> Play
                    </button>
                </div>
            `).join('');
        }

        // =========== ANALYTICS DASHBOARD ===========
        function loadAnalyticsDashboard(weatherData) {
            const container = document.getElementById('analytics-grid');
            if (!weatherData) return;
            
            const temps = weatherData.weather.map(day => parseInt(day.avgtempC));
            const avgTemp = temps.reduce((a, b) => a + b) / temps.length;
            const maxTemp = Math.max(...temps);
            const minTemp = Math.min(...temps);
            
            container.innerHTML = `
                <div class="metric-card">
                    <h4>Temperature Variance</h4>
                    <div class="metric-value">±${(maxTemp - minTemp).toFixed(1)}°C</div>
                    <div class="metric-trend" style="color: var(--success);">Stable</div>
                </div>
                <div class="metric-card">
                    <h4>Humidity Pattern</h4>
                    <div class="metric-value">${weatherData.current_condition[0].humidity}% avg</div>
                    <div class="metric-detail">Normal range</div>
                </div>
                <div class="metric-card">
                    <h4>Wind Consistency</h4>
                    <div class="metric-value">Moderate</div>
                    <div class="metric-detail">${weatherData.current_condition[0].windspeedKmph}-${parseInt(weatherData.current_condition[0].windspeedKmph) + 5} km/h range</div>
                </div>
            `;
        }

        // =========== YOUR EXISTING WEATHER CODE ===========
        // Theme Management
        const themeToggle = document.getElementById('theme-toggle');
        const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
        
        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            
            if (savedTheme === 'dark' || (!savedTheme && prefersDarkScheme.matches)) {
                document.documentElement.setAttribute('data-theme', 'dark');
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
            }
        }
        
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }
        
        themeToggle.addEventListener('click', toggleTheme);
        document.addEventListener('DOMContentLoaded', initTheme);
        
        prefersDarkScheme.addEventListener('change', (e) => {
            if (!localStorage.getItem('theme')) {
                document.documentElement.setAttribute('data-theme', e.matches ? 'dark' : 'light');
            }
        });

        // API Configuration
        const WWO_API_KEY = 'fe069070fb0c4fc9b4e161820262701';
        const WWO_BASE_URL = 'https://api.worldweatheronline.com/premium/v1';

        // DOM Elements
        const cityInput = document.getElementById('city-input');
        const searchBtn = document.getElementById('search-btn');
        const locationBtn = document.getElementById('location-btn');
        const voiceSearchBtn = document.getElementById('voice-search-btn');
        const mainContent = document.getElementById('main-content');
        const loader = document.getElementById('loader');
        const errorMessage = document.getElementById('error-message');
        const celsiusBtn = document.getElementById('celsius-btn');
        const fahrenheitBtn = document.getElementById('fahrenheit-btn');
        const exportPdfBtn = document.getElementById('export-pdf');
        const shareWeatherBtn = document.getElementById('share-weather');
        const saveLocationBtn = document.getElementById('save-location');

        // State variables
        let currentUnit = 'metric';
        let recentSearches = JSON.parse(localStorage.getItem('recentSearches')) || [];
        let savedLocations = JSON.parse(localStorage.getItem('savedLocations')) || [];
        let currentWeatherData = null;

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            updateDateTime();
            setInterval(updateDateTime, 60000);
            
            updateFooterTimestamp();
            setInterval(updateFooterTimestamp, 1000);
            
            const lastCity = localStorage.getItem('lastCity') || 'New York';
            getWeatherData(lastCity);
            
            renderRecentSearches();
            updateSavedLocationsButton();
            
            // Initialize features
            loadAchievements();
            loadWeatherQuiz();
            updateComparisonGrid();
            loadWeatherEducation();
            updateOnlineStatus();
            
            // Event Listeners
            searchBtn.addEventListener('click', handleSearch);
            locationBtn.addEventListener('click', handleLocation);
            voiceSearchBtn.addEventListener('click', handleVoiceSearch);
            cityInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') handleSearch();
            });
            
            celsiusBtn.addEventListener('click', () => switchUnit('metric'));
            fahrenheitBtn.addEventListener('click', () => switchUnit('imperial'));
            
            exportPdfBtn.addEventListener('click', exportAsPDF);
            shareWeatherBtn.addEventListener('click', shareWeather);
            saveLocationBtn.addEventListener('click', saveCurrentLocation);
            
            // Make hourly forecast scrollable with keyboard
            const hourlyContainer = document.getElementById('hourly-forecast');
            hourlyContainer.setAttribute('tabindex', '0');
            hourlyContainer.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft') {
                    hourlyContainer.scrollLeft -= 100;
                } else if (e.key === 'ArrowRight') {
                    hourlyContainer.scrollLeft += 100;
                }
            });

            // Initialize voice recognition if available
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            } else {
                voiceSearchBtn.style.display = 'none';
            }

            // Check for emergency alerts every 5 minutes
            setInterval(checkEmergencyAlerts, 5 * 60 * 1000);
            checkEmergencyAlerts();
            
            // Initialize language
            updateAllText();
        });

        // Update current date and time
        function updateDateTime() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            document.getElementById('current-date-time').textContent = now.toLocaleDateString('en-US', options);
        }

        // Update footer timestamp
        function updateFooterTimestamp() {
            const now = new Date();
            const options = { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            };
            const timestamp = now.toLocaleDateString('en-US', options);
            document.getElementById('footer-timestamp').textContent = `Last updated: ${timestamp}`;
        }

        // Handle city search
        function handleSearch() {
            const city = cityInput.value.trim();
            if (city) {
                getWeatherData(city);
                cityInput.value = '';
            } else {
                showError('Please enter a city name');
            }
        }

        // Handle location button click
        function handleLocation() {
            if (navigator.geolocation) {
                showLoader();
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const { latitude, longitude } = position.coords;
                        getWeatherByCoords(latitude, longitude);
                    },
                    error => {
                        hideLoader();
                        showError('Unable to retrieve your location. Please enable location services.');
                    }
                );
            } else {
                showError('Geolocation is not supported by your browser');
            }
        }

        // Handle voice search
        function handleVoiceSearch() {
            if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
                showError('Voice search is not supported in your browser');
                return;
            }

            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'en-US';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            voiceSearchBtn.classList.add('listening');
            recognition.start();

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                cityInput.value = transcript;
                getWeatherData(transcript);
                voiceSearchBtn.classList.remove('listening');
            };

            recognition.onerror = (event) => {
                showError('Voice recognition error: ' + event.error);
                voiceSearchBtn.classList.remove('listening');
            };

            recognition.onend = () => {
                voiceSearchBtn.classList.remove('listening');
            };
        }

        // Get weather data by city name using WWO API
        async function getWeatherData(city) {
            showLoader();
            try {
                const weatherUrl = `${WWO_BASE_URL}/weather.ashx?key=${WWO_API_KEY}&q=${encodeURIComponent(city)}&format=json&num_of_days=5&fx=yes&cc=yes&mca=no&fx24=yes&includelocation=yes&tp=3&show_comments=no&extra=isDayTime&date=today&alerts=yes`;
                
                const unitParam = currentUnit === 'metric' ? 'm' : 'u';
                const fullUrl = `${weatherUrl}&${unitParam === 'm' ? 'mca=yes' : ''}`;
                
                const response = await fetch(fullUrl);
                
                if (!response.ok) {
                    throw new Error('Unable to fetch weather data. Please check your internet connection.');
                }
                
                const data = await response.json();
                
                if (data.data.error) {
                    throw new Error(data.data.error[0].msg || 'City not found. Please check the spelling or try a different city.');
                }
                
                currentWeatherData = data.data;
                
                // Cache data for offline use
                localStorage.setItem('cachedWeatherData', JSON.stringify(data.data));
                
                // Update all UI components
                updateCurrentWeather(data.data);
                updateForecast(data.data);
                updateHourlyForecast(data.data);
                updateAirQuality(data.data);
                updateAstronomyData(data.data);
                updateWeatherAlerts(data.data);
                updateClothingRecommendations(data.data);
                updateWeatherMap(data.data);
                updateWeatherBackground(data.data.current_condition[0].weatherDesc[0].value.toLowerCase());
                
                // Update advanced features
                generateAIInsights(data.data);
                generateHealthTips(data.data);
                loadAnalyticsDashboard(data.data);
                
                updateFooterTimestamp();
                
                addToRecentSearches(city, data.data.nearest_area[0].country[0].value);
                
                localStorage.setItem('lastCity', city);
                
                hideLoader();
                showMainContent();
            } catch (error) {
                hideLoader();
                showError(error.message);
            }
        }

        // Get weather data by coordinates using WWO API
        async function getWeatherByCoords(lat, lon) {
            showLoader();
            try {
                const query = `${lat},${lon}`;
                const weatherUrl = `${WWO_BASE_URL}/weather.ashx?key=${WWO_API_KEY}&q=${query}&format=json&num_of_days=5&fx=yes&cc=yes&mca=no&fx24=yes&includelocation=yes&tp=3&show_comments=no&extra=isDayTime&date=today&alerts=yes`;
                
                const unitParam = currentUnit === 'metric' ? 'm' : 'u';
                const fullUrl = `${weatherUrl}&${unitParam === 'm' ? 'mca=yes' : ''}`;
                
                const response = await fetch(fullUrl);
                const data = await response.json();
                
                if (data.data.error) {
                    throw new Error(data.data.error[0].msg || 'Location not found');
                }
                
                currentWeatherData = data.data;
                
                // Cache data for offline use
                localStorage.setItem('cachedWeatherData', JSON.stringify(data.data));
                
                updateCurrentWeather(data.data);
                updateForecast(data.data);
                updateHourlyForecast(data.data);
                updateAirQuality(data.data);
                updateAstronomyData(data.data);
                updateWeatherAlerts(data.data);
                updateClothingRecommendations(data.data);
                updateWeatherMap(data.data);
                updateWeatherBackground(data.data.current_condition[0].weatherDesc[0].value.toLowerCase());
                
                // Update advanced features
                generateAIInsights(data.data);
                generateHealthTips(data.data);
                loadAnalyticsDashboard(data.data);
                
                updateFooterTimestamp();
                
                const cityName = data.data.nearest_area[0].areaName[0].value;
                const countryName = data.data.nearest_area[0].country[0].value;
                
                addToRecentSearches(cityName, countryName);
                localStorage.setItem('lastCity', cityName);
                
                hideLoader();
                showMainContent();
            } catch (error) {
                hideLoader();
                showError('Unable to fetch weather data for your location. Please try again.');
            }
        }

        // Update current weather display
        function updateCurrentWeather(data) {
            const current = data.current_condition[0];
            const area = data.nearest_area[0];
            
            document.getElementById('city-name').textContent = `${area.areaName[0].value}, ${area.country[0].value}`;
            document.getElementById('current-temp').textContent = currentUnit === 'metric' ? current.temp_C : current.temp_F;
            document.getElementById('temp-unit').textContent = currentUnit === 'metric' ? 'C' : 'F';
            document.getElementById('weather-description').textContent = current.weatherDesc[0].value;
            document.getElementById('wind-speed').textContent = currentUnit === 'metric' ? `${current.windspeedKmph} km/h` : `${current.windspeedMiles} mph`;
            document.getElementById('humidity').textContent = `${current.humidity}%`;
            document.getElementById('feels-like').textContent = currentUnit === 'metric' ? `${current.FeelsLikeC}°C` : `${current.FeelsLikeF}°F`;
            document.getElementById('pressure').textContent = `${current.pressure} mb`;
            
            const weatherIcon = document.getElementById('weather-icon');
            const iconClass = getWWOWeatherIcon(current.weatherCode, current.isDayTime === 'yes');
            weatherIcon.className = `fas ${iconClass}`;
        }

        // Update 5-day forecast
        function updateForecast(data) {
            const forecastDaysContainer = document.getElementById('forecast-days');
            forecastDaysContainer.innerHTML = '';
            
            const forecastDays = data.weather.slice(0, 5);
            
            forecastDays.forEach(dayData => {
                const date = new Date(dayData.date);
                const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
                const dayMonth = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                
                const tempMax = currentUnit === 'metric' ? dayData.maxtempC : dayData.maxtempF;
                const tempMin = currentUnit === 'metric' ? dayData.mintempC : dayData.mintempF;
                const iconClass = getWWOWeatherIcon(parseInt(dayData.hourly[4].weatherCode), true);
                
                const forecastDayHTML = `
                    <div class="forecast-day">
                        <div class="day">${dayName}</div>
                        <div class="date">${dayMonth}</div>
                        <div class="weather-icon">
                            <i class="fas ${iconClass}"></i>
                        </div>
                        <div class="forecast-temp">
                            <div class="temp-high">${Math.round(tempMax)}°</div>
                            <div class="temp-low">${Math.round(tempMin)}°</div>
                        </div>
                        <div class="weather-desc">${dayData.hourly[4].weatherDesc[0].value}</div>
                    </div>
                `;
                
                forecastDaysContainer.innerHTML += forecastDayHTML;
            });
        }

        // Update hourly forecast
        function updateHourlyForecast(data) {
            const hourlyContainer = document.getElementById('hourly-forecast');
            hourlyContainer.innerHTML = '';
            
            const hourlyData = data.weather[0].hourly.slice(0, 8);
            
            hourlyData.forEach(hour => {
                const timeStr = hour.time.toString().padStart(4, '0');
                const hours = parseInt(timeStr.substring(0, 2));
                const period = hours >= 12 ? 'PM' : 'AM';
                const displayHours = hours % 12 || 12;
                const timeDisplay = `${displayHours}${period}`;
                
                const temp = currentUnit === 'metric' ? hour.tempC : hour.tempF;
                const iconClass = getWWOWeatherIcon(parseInt(hour.weatherCode), hour.isDayTime === 'yes');
                
                const hourlyItemHTML = `
                    <div class="hourly-item" tabindex="0">
                        <div class="time">${timeDisplay}</div>
                        <div class="weather-icon">
                            <i class="fas ${iconClass}"></i>
                        </div>
                        <div class="temp">${Math.round(temp)}°</div>
                    </div>
                `;
                
                hourlyContainer.innerHTML += hourlyItemHTML;
            });
        }

        // Update astronomy data
        function updateAstronomyData(data) {
            const astronomy = data.weather[0].astronomy[0];
            
            document.getElementById('sunrise-time').textContent = astronomy.sunrise;
            document.getElementById('sunset-time').textContent = astronomy.sunset;
            document.getElementById('moon-phase').textContent = astronomy.moon_phase;
            
            // Calculate day length
            const sunrise = parseTime(astronomy.sunrise);
            const sunset = parseTime(astronomy.sunset);
            const dayLength = sunset - sunrise;
            const hours = Math.floor(dayLength / 60);
            const minutes = dayLength % 60;
            document.getElementById('day-length').textContent = `${hours}h ${minutes}m`;
        }

        // Helper function to parse time
        function parseTime(timeStr) {
            const [time, period] = timeStr.split(' ');
            let [hours, minutes] = time.split(':').map(Number);
            
            if (period === 'PM' && hours !== 12) hours += 12;
            if (period === 'AM' && hours === 12) hours = 0;
            
            return hours * 60 + minutes;
        }

        // Update weather alerts
        function updateWeatherAlerts(data) {
            const alertsContainer = document.getElementById('weather-alerts');
            alertsContainer.innerHTML = '';
            
            // Check for alerts in the data
            if (data.weather && data.weather[0].hourly) {
                const hourlyData = data.weather[0].hourly;
                
                // Check for precipitation alerts
                hourlyData.forEach(hour => {
                    const precipMM = parseFloat(hour.precipMM) || 0;
                    const chanceofrain = parseInt(hour.chanceofrain) || 0;
                    
                    if (precipMM > 5 || chanceofrain > 70) {
                        const alertHTML = `
                            <div class="alert-item">
                                <div class="alert-title">
                                    <i class="fas fa-cloud-rain"></i>
                                    Rain Alert
                                </div>
                                <div class="alert-message">
                                    Heavy rain expected (${precipMM}mm, ${chanceofrain}% chance)
                                </div>
                            </div>
                        `;
                        alertsContainer.innerHTML += alertHTML;
                    }
                });
            }
            
            // If no alerts, show info message
            if (alertsContainer.innerHTML === '') {
                alertsContainer.innerHTML = `
                    <div class="alert-item info">
                        <div class="alert-title">
                            <i class="fas fa-info-circle"></i>
                            No Active Alerts
                        </div>
                        <div class="alert-message">
                            No severe weather alerts for this location.
                        </div>
                    </div>
                `;
            }
        }

        // Update clothing recommendations
        function updateClothingRecommendations(data) {
            const clothingContainer = document.getElementById('clothing-items');
            clothingContainer.innerHTML = '';
            
            const currentTemp = parseFloat(data.current_condition[0].temp_C);
            const weatherDesc = data.current_condition[0].weatherDesc[0].value.toLowerCase();
            const windSpeed = parseFloat(data.current_condition[0].windspeedKmph);
            
            const clothingItems = [];
            
            // Temperature-based recommendations
            if (currentTemp > 25) {
                clothingItems.push({ icon: 'fa-tshirt', text: 'Light shirt' });
                clothingItems.push({ icon: 'fa-sun', text: 'Sunglasses' });
                clothingItems.push({ icon: 'fa-hat-cowboy', text: 'Hat' });
            } else if (currentTemp > 15) {
                clothingItems.push({ icon: 'fa-tshirt', text: 'T-shirt' });
                clothingItems.push({ icon: 'fa-jacket', text: 'Light jacket' });
            } else if (currentTemp > 5) {
                clothingItems.push({ icon: 'fa-sweater', text: 'Sweater' });
                clothingItems.push({ icon: 'fa-jacket', text: 'Jacket' });
            } else {
                clothingItems.push({ icon: 'fa-snowflake', text: 'Winter coat' });
                clothingItems.push({ icon: 'fa-mitten', text: 'Gloves' });
                clothingItems.push({ icon: 'fa-hat-winter', text: 'Winter hat' });
            }
            
            // Weather condition-based recommendations
            if (weatherDesc.includes('rain')) {
                clothingItems.push({ icon: 'fa-umbrella', text: 'Umbrella' });
                clothingItems.push({ icon: 'fa-water', text: 'Raincoat' });
            }
            
            if (weatherDesc.includes('snow')) {
                clothingItems.push({ icon: 'fa-snowman', text: 'Snow boots' });
            }
            
            if (windSpeed > 20) {
                clothingItems.push({ icon: 'fa-wind', text: 'Windbreaker' });
            }
            
            // Add clothing items to container
            clothingItems.forEach(item => {
                const clothingHTML = `
                    <div class="clothing-item">
                        <i class="fas ${item.icon}"></i>
                        <span>${item.text}</span>
                    </div>
                `;
                clothingContainer.innerHTML += clothingHTML;
            });
        }

        // Update weather map
        function updateWeatherMap(data) {
            const area = data.nearest_area[0];
            const lat = parseFloat(area.latitude[0].value);
            const lon = parseFloat(area.longitude[0].value);
            
            const mapIframe = document.getElementById('weather-map');
            mapIframe.src = `https://embed.windy.com/embed2.html?lat=${lat}&lon=${lon}&zoom=5&level=surface&overlay=wind&menu=&message=true&marker=true&calendar=now&pressure=&type=map&location=coordinates&detail=true&metricWind=default&metricTemp=default&radarRange=-1`;
        }

        // Update weather background animation
        function updateWeatherBackground(weatherDesc) {
            const background = document.getElementById('weather-background');
            background.className = 'weather-background';
            
            if (weatherDesc.includes('sun') || weatherDesc.includes('clear')) {
                background.classList.add('sunny-bg');
            } else if (weatherDesc.includes('rain') || weatherDesc.includes('storm')) {
                background.classList.add('rainy-bg');
            } else if (weatherDesc.includes('cloud')) {
                background.classList.add('cloudy-bg');
            } else {
                background.classList.add('sunny-bg');
            }
        }

        // Update air quality display
        function updateAirQuality(data) {
            const current = data.current_condition[0];
            const uvIndex = current.uvIndex || 'N/A';
            
            const aqiValue = document.getElementById('aqi-value');
            const aqiStatus = document.getElementById('aqi-status');
            const aqiDescription = document.getElementById('aqi-description');
            
            aqiValue.classList.remove('aqi-good', 'aqi-moderate', 'aqi-unhealthy');
            
            aqiValue.textContent = uvIndex;
            
            const uvNum = parseInt(uvIndex);
            if (uvNum <= 2) {
                aqiValue.classList.add('aqi-good');
                aqiStatus.textContent = 'UV: Low';
                aqiDescription.textContent = 'Low UV radiation. Minimal protection required.';
            } else if (uvNum <= 5) {
                aqiValue.classList.add('aqi-moderate');
                aqiStatus.textContent = 'UV: Moderate';
                aqiDescription.textContent = 'Moderate UV radiation. Protection recommended.';
            } else if (uvNum <= 7) {
                aqiValue.classList.add('aqi-unhealthy');
                aqiStatus.textContent = 'UV: High';
                aqiDescription.textContent = 'High UV radiation. Protection essential.';
            } else if (uvNum <= 10) {
                aqiValue.classList.add('aqi-unhealthy');
                aqiStatus.textContent = 'UV: Very High';
                aqiDescription.textContent = 'Very high UV radiation. Extra protection needed.';
            } else {
                aqiValue.classList.add('aqi-unhealthy');
                aqiStatus.textContent = 'UV: Extreme';
                aqiDescription.textContent = 'Extreme UV radiation. Avoid sun exposure.';
            }
        }

        // Add city to recent searches
        function addToRecentSearches(city, country) {
            const searchItem = `${city}, ${country}`;
            
            recentSearches = recentSearches.filter(item => item !== searchItem);
            recentSearches.unshift(searchItem);
            
            if (recentSearches.length > 5) {
                recentSearches.pop();
            }
            
            localStorage.setItem('recentSearches', JSON.stringify(recentSearches));
            renderRecentSearches();
        }

        // Render recent searches
        function renderRecentSearches() {
            const recentList = document.getElementById('recent-searches');
            recentList.innerHTML = '';
            
            recentSearches.forEach(city => {
                const recentItem = document.createElement('div');
                recentItem.className = 'recent-item';
                recentItem.textContent = city;
                recentItem.tabIndex = 0;
                recentItem.addEventListener('click', () => {
                    const cityName = city.split(',')[0];
                    getWeatherData(cityName);
                });
                recentItem.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const cityName = city.split(',')[0];
                        getWeatherData(cityName);
                    }
                });
                
                recentList.appendChild(recentItem);
            });
        }

        // Save current location
        function saveCurrentLocation() {
            if (!currentWeatherData) {
                showError('No weather data available to save');
                return;
            }
            
            const area = currentWeatherData.nearest_area[0];
            const city = area.areaName[0].value;
            const country = area.country[0].value;
            const location = `${city}, ${country}`;
            
            if (!savedLocations.includes(location)) {
                savedLocations.push(location);
                localStorage.setItem('savedLocations', JSON.stringify(savedLocations));
                updateSavedLocationsButton();
                showNotification(`Saved ${location} to your locations`);
            } else {
                showNotification(`${location} is already saved`);
            }
        }

        // Update save location button
        function updateSavedLocationsButton() {
            if (!currentWeatherData) return;
            
            const area = currentWeatherData.nearest_area[0];
            const city = area.areaName[0].value;
            const country = area.country[0].value;
            const location = `${city}, ${country}`;
            
            if (savedLocations.includes(location)) {
                saveLocationBtn.innerHTML = '<i class="fas fa-bookmark"></i> Saved';
                saveLocationBtn.disabled = true;
            } else {
                saveLocationBtn.innerHTML = '<i class="fas fa-bookmark"></i> Save Location';
                saveLocationBtn.disabled = false;
            }
        }

        // Show notification
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'alert-item info';
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.right = '20px';
            notification.style.zIndex = '1000';
            notification.innerHTML = `
                <div class="alert-title">
                    <i class="fas fa-info-circle"></i>
                    Notification
                </div>
                <div class="alert-message">${message}</div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Switch temperature unit
        function switchUnit(unit) {
            if (unit === currentUnit) return;
            
            currentUnit = unit;
            
            if (unit === 'metric') {
                celsiusBtn.classList.add('active');
                fahrenheitBtn.classList.remove('active');
            } else {
                celsiusBtn.classList.remove('active');
                fahrenheitBtn.classList.add('active');
            }
            
            const currentCityElement = document.getElementById('city-name');
            if (currentCityElement && currentCityElement.textContent) {
                const currentCity = currentCityElement.textContent.split(',')[0].trim();
                getWeatherData(currentCity);
            }
        }

        // Export as PDF
        function exportAsPDF() {
            const city = document.getElementById('city-name').textContent;
            const temp = document.getElementById('current-temp').textContent;
            const unit = document.getElementById('temp-unit').textContent;
            const description = document.getElementById('weather-description').textContent;
            
            const content = `
                Weather Report - ${city}
                ========================
                
                Current Weather:
                - Temperature: ${temp}°${unit}
                - Condition: ${description}
                - Last Updated: ${new Date().toLocaleString()}
                
                This report was generated by WeatherCast Pro.
            `;
            
            // Create a blob and download link
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `weather-report-${city.replace(/,/g, '').replace(/\s+/g, '-')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Weather report downloaded');
        }

        // Share weather
        function shareWeather() {
            const city = document.getElementById('city-name').textContent;
            const temp = document.getElementById('current-temp').textContent;
            const unit = document.getElementById('temp-unit').textContent;
            const description = document.getElementById('weather-description').textContent;
            
            const text = `Current weather in ${city}: ${temp}°${unit} and ${description}. Check it out on WeatherCast Pro!`;
            
            if (navigator.share) {
                navigator.share({
                    title: `Weather in ${city}`,
                    text: text,
                    url: window.location.href
                });
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(text).then(() => {
                    showNotification('Weather info copied to clipboard!');
                });
            }
        }

        // Get appropriate weather icon class
        function getWWOWeatherIcon(weatherCode, isDayTime = true) {
            if (weatherCode === 113) {
                return isDayTime ? 'fa-sun' : 'fa-moon';
            } else if (weatherCode === 116) {
                return isDayTime ? 'fa-cloud-sun' : 'fa-cloud-moon';
            } else if (weatherCode === 119 || weatherCode === 122) {
                return 'fa-cloud';
            } else if (weatherCode === 143 || weatherCode === 248 || weatherCode === 260) {
                return 'fa-smog';
            } else if (weatherCode === 176 || weatherCode === 263 || weatherCode === 266) {
                return isDayTime ? 'fa-cloud-sun-rain' : 'fa-cloud-moon-rain';
            } else if (weatherCode === 179 || weatherCode === 293 || weatherCode === 296 || 
                     weatherCode === 299 || weatherCode === 302 || weatherCode === 305) {
                return 'fa-cloud-rain';
            } else if (weatherCode === 308 || weatherCode === 311 || weatherCode === 314) {
                return 'fa-cloud-showers-heavy';
            } else if (weatherCode >= 179 && weatherCode <= 203 || 
                     weatherCode === 227 || weatherCode === 230 || 
                     weatherCode === 320 || weatherCode === 323 || 
                     weatherCode === 326 || weatherCode === 329 || 
                     weatherCode === 332 || weatherCode === 335 || 
                     weatherCode === 338 || weatherCode === 350) {
                return 'fa-snowflake';
            } else if (weatherCode === 200 || weatherCode === 386 || 
                     weatherCode === 389 || weatherCode === 392 || 
                     weatherCode === 395) {
                return 'fa-bolt';
            } else if (weatherCode === 182 || weatherCode === 185 || 
                     weatherCode === 281 || weatherCode === 284 || 
                     weatherCode === 311 || weatherCode === 314 || 
                     weatherCode === 317 || weatherCode === 356 || 
                     weatherCode === 359 || weatherCode === 365 || 
                     weatherCode === 368 || weatherCode === 371 || 
                     weatherCode === 374) {
                return 'fa-cloud-meatball';
            } else {
                return 'fa-cloud';
            }
        }

        // UI Helper Functions
        function showLoader() {
            loader.style.display = 'block';
            mainContent.style.display = 'none';
            errorMessage.style.display = 'none';
        }

        function hideLoader() {
            loader.style.display = 'none';
        }

        function showMainContent() {
            mainContent.style.display = 'grid';
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            mainContent.style.display = 'none';
            loader.style.display = 'none';
            
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 5000);
        }

        // Check if API key is set, otherwise use mock data
        if (WWO_API_KEY === 'YOUR_WWO_API_KEY_HERE') {
            console.warn("Please add your World Weather Online API key to get real weather data");
            setTimeout(loadMockData, 1000);
        }

        // Mock data function for demonstration
        function loadMockData() {
            console.log("Loading mock data for demonstration");
            
            // Update with mock data
            document.getElementById('city-name').textContent = "New York, US";
            document.getElementById('current-temp').textContent = "24";
            document.getElementById('weather-description').textContent = "Partly Cloudy";
            document.getElementById('wind-speed').textContent = "12 km/h";
            document.getElementById('humidity').textContent = "65%";
            document.getElementById('feels-like').textContent = "26°C";
            document.getElementById('pressure').textContent = "1013 mb";
            
            // Mock astronomy data
            document.getElementById('sunrise-time').textContent = "6:45 AM";
            document.getElementById('sunset-time').textContent = "7:30 PM";
            document.getElementById('moon-phase').textContent = "Waxing Crescent";
            document.getElementById('day-length').textContent = "12h 45m";
            
            // Mock forecast data
            const forecastDaysContainer = document.getElementById('forecast-days');
            forecastDaysContainer.innerHTML = '';
            
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'];
            const tempsHigh = [22, 24, 26, 23, 21];
            const tempsLow = [18, 20, 22, 19, 17];
            
            days.forEach((day, index) => {
                const forecastDayHTML = `
                    <div class="forecast-day">
                        <div class="day">${day}</div>
                        <div class="date">Oct ${10 + index}</div>
                        <div class="weather-icon">
                            <i class="fas fa-cloud-sun"></i>
                        </div>
                        <div class="forecast-temp">
                            <div class="temp-high">${tempsHigh[index]}°</div>
                            <div class="temp-low">${tempsLow[index]}°</div>
                        </div>
                        <div class="weather-desc">Partly Cloudy</div>
                    </div>
                `;
                forecastDaysContainer.innerHTML += forecastDayHTML;
            });
            
            // Mock clothing recommendations
            updateClothingRecommendations({
                current_condition: [{
                    temp_C: "24",
                    weatherDesc: [{value: "Partly Cloudy"}],
                    windspeedKmph: "12"
                }]
            });
            
            // Initialize features with mock data
            const mockWeatherData = {
                current_condition: [{ temp_C: "24", humidity: "65", windspeedKmph: "12", uvIndex: "5", weatherDesc: [{value: "Partly Cloudy"}] }],
                weather: [{ hourly: [{ chanceofrain: "30" }] }]
            };
            
            generateAIInsights(mockWeatherData);
            generateHealthTips(mockWeatherData);
            loadAnalyticsDashboard(mockWeatherData);
            
            hideLoader();
            showMainContent();
        }
    </script>

    <!-- Service Worker Script -->
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('service-worker.js').then(function(registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }

        // Create service worker file content
        const serviceWorkerContent = `
self.addEventListener('install', function(event) {
    event.waitUntil(
        caches.open('weather-cache-v1').then(function(cache) {
            return cache.addAll([
                '/',
                '/index.html',
                '/styles.css',
                '/app.js',
                'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css',
                'https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500&display=swap'
            ]);
        })
    );
});

self.addEventListener('fetch', function(event) {
    event.respondWith(
        caches.match(event.request).then(function(response) {
            return response || fetch(event.request);
        })
    );
});

self.addEventListener('activate', function(event) {
    var cacheWhitelist = ['weather-cache-v1'];
    event.waitUntil(
        caches.keys().then(function(cacheNames) {
            return Promise.all(
                cacheNames.map(function(cacheName) {
                    if (cacheWhitelist.indexOf(cacheName) === -1) {
                        return caches.delete(cacheName);
                    }
                })
            );
        })
    );
});
        `;

        // Create and download service worker file
        function createServiceWorker() {
            const blob = new Blob([serviceWorkerContent], { type: 'application/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'service-worker.js';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Create manifest file
        const manifestContent = {
            "name": "WeatherCast Pro",
            "short_name": "WeatherCast",
            "description": "Live weather forecasts with AI predictions",
            "start_url": "/",
            "display": "standalone",
            "theme_color": "#32a1ce",
            "background_color": "#1a1a2e",
            "icons": [
                {
                    "src": "/icon-192x192.png",
                    "sizes": "192x192",
                    "type": "image/png"
                },
                {
                    "src": "/icon-512x512.png",
                    "sizes": "512x512",
                    "type": "image/png"
                }
            ]
        };

        function createManifest() {
            const blob = new Blob([JSON.stringify(manifestContent, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'manifest.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Auto-create service worker and manifest on first load
        document.addEventListener('DOMContentLoaded', function() {
            if (!localStorage.getItem('pwaFilesCreated')) {
                setTimeout(() => {
                    createServiceWorker();
                    createManifest();
                    localStorage.setItem('pwaFilesCreated', 'true');
                    console.log('PWA files created successfully');
                }, 1000);
            }
        });
    </script>
</body>
</html>